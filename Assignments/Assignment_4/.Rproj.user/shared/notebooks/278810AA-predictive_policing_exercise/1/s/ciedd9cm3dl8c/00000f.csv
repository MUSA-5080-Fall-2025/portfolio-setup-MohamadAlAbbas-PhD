"0","# Function to calculate Local Moran's I"
"0","calculate_local_morans <- function(data, variable, k = 5) {"
"0","  "
"0","  # Create spatial weights"
"0","  coords <- st_coordinates(st_centroid(data))"
"0","  neighbors <- knn2nb(knearneigh(coords, k = k))"
"0","  weights <- nb2listw(neighbors, style = ""W"", zero.policy = TRUE)"
"0","  "
"0","  # Calculate Local Moran's I"
"0","  local_moran <- localmoran(data[[variable]], weights)"
"0","  "
"0","  # Classify clusters"
"0","  mean_val <- mean(data[[variable]], na.rm = TRUE)"
"0","  "
"0","  data %>%"
"0","    mutate("
"0","      local_i = local_moran[, 1],"
"0","      p_value = local_moran[, 5],"
"0","      is_significant = p_value < 0.05,"
"0","      "
"0","      moran_class = case_when("
"0","        !is_significant ~ ""Not Significant"","
"0","        local_i > 0 & .data[[variable]] > mean_val ~ ""High-High"","
"0","        local_i > 0 & .data[[variable]] <= mean_val ~ ""Low-Low"","
"0","        local_i < 0 & .data[[variable]] > mean_val ~ ""High-Low"","
"0","        local_i < 0 & .data[[variable]] <= mean_val ~ ""Low-High"","
"0","        TRUE ~ ""Not Significant"""
"0","      )"
"0","    )"
"0","}"
"0",""
"0","# Apply to abandoned cars"
"0","fishnet <- calculate_local_morans(fishnet, ""abandoned_cars"", k = 5)"
"2","Error in localmoran(data[[variable]], weights) : is.vector(x) is not TRUE
"
