"0","#| label: logo-cv-negbin-model"
"0","#| message: false"
"0","#| warning: false"
"0","#| results: 'hide'"
"0","# ---- LOGO Cross-Validation (NegBin only; DV = burglaries) ----"
"0",""
"0","districts <- unique(fishnet_model$District)"
"0","cv_preds  <- tibble::tibble()"
"0",""
"0","for (i in seq_along(districts)) {"
"0","  test_district <- districts[i]"
"0",""
"0","  # Split data"
"0","  train_data <- dplyr::filter(fishnet_model, District != test_district)"
"0","  test_data  <- dplyr::filter(fishnet_model, District == test_district)"
"0",""
"0","  # Fit Negative Binomial on training fold"
"0","  m_nb <- MASS::glm.nb("
"0","    burglaries ~"
"0","      abandoned_houses +        # predictor (keep)"
"0","      abandoned_houses.nn +     # predictor (keep)"
"0","      dist_to_hotspot +         # predictor (keep)"
"0","      pct_black + pct_hisp +"
"0","      pct_poverty + pct_renter +"
"0","      log_income +"
"0","      pct_45_64 + pct_65_plus,"
"0","    data = train_data"
"0","  )"
"0",""
"0","  # Predict on held-out district"
"0","  preds <- test_data %>%"
"0","    dplyr::transmute("
"0","      fold          = i,"
"0","      test_district = test_district,"
"0","      uniqueID,"
"0","      y             = burglaries,"
"0","      pred_negbin   = stats::predict(m_nb, newdata = ., type = ""response"")"
"0","    )"
"0",""
"0","  cv_preds <- dplyr::bind_rows(cv_preds, preds)"
"0","}"
"0","  "
