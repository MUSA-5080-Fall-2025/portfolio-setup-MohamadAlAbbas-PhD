"0","#| message: false"
"0","#| results: 'hide'"
"0",""
"0","# Join district information to fishnet"
"0","fishnet <- st_join("
"0","  fishnet,"
"0","  policeDistricts,"
"0","  join = st_within,"
"0","  left = TRUE"
"0",") %>%"
"0","  filter(!is.na(District))  # Remove cells outside districts"
"0",""
"0","cat(""✓ Joined police districts\n"")"
"1","✓ Joined police districts
"
"0","cat(""  - Districts:"", length(unique(fishnet$District)), ""\n"")"
"1","  - Districts:"
"1"," "
"1","22"
"1"," "
"1","
"
"0","cat(""  - Cells:"", nrow(fishnet), ""\n"")"
"1","  - Cells:"
"1"," "
"1","1708"
"1"," "
"1","
"
"0","acs_year <- 2017"
"0",""
"0","# One variable set: race/eth, poverty, tenure, vacancy, income, total pop, and age bins"
"0","acs_vars <- c("
"0","  # Totals / Income"
"0","  tot_pop = ""B03002_001"","
"0","  med_inc = ""B19013_001"","
"0",""
"0","  # Race / Ethnicity (not Hispanic for white/black; Hispanic any race)"
"0","  white   = ""B03002_003"","
"0","  black   = ""B03002_004"","
"0","  hisp    = ""B03002_012"","
"0",""
"0","  # Poverty"
"0","  pov_tot = ""B17001_001"","
"0","  pov_num = ""B17001_002"","
"0",""
"0","  # Tenure & vacancy"
"0","  occ_tot = ""B25003_001"","
"0","  renters = ""B25003_003"","
"0","  vac_tot = ""B25002_001"","
"0","  vac_cnt = ""B25002_003"","
"0",""
"0","  # --- Age bins from B01001"
"0","  # Male 45–64"
"0","  m45_49 = ""B01001_015"","
"0","  m50_54 = ""B01001_016"","
"0","  m55_59 = ""B01001_017"","
"0","  m60_61 = ""B01001_018"","
"0","  m62_64 = ""B01001_019"","
"0","  # Male 65+"
"0","  m65_66 = ""B01001_020"","
"0","  m67_69 = ""B01001_021"","
"0","  m70_74 = ""B01001_022"","
"0","  m75_79 = ""B01001_023"","
"0","  m80_84 = ""B01001_024"","
"0","  m85p   = ""B01001_025"","
"0","  # Female 45–64"
"0","  f45_49 = ""B01001_039"","
"0","  f50_54 = ""B01001_040"","
"0","  f55_59 = ""B01001_041"","
"0","  f60_61 = ""B01001_042"","
"0","  f62_64 = ""B01001_043"","
"0","  # Female 65+"
"0","  f65_66 = ""B01001_044"","
"0","  f67_69 = ""B01001_045"","
"0","  f70_74 = ""B01001_046"","
"0","  f75_79 = ""B01001_047"","
"0","  f80_84 = ""B01001_048"","
"0","  f85p   = ""B01001_049"""
"0",")"
"0",""
"0","# Pull Cook County tracts with geometry"
"0","tracts_all <- get_acs("
"0","  geography = ""tract"","
"0","  state = ""IL"","
"0","  county = ""Cook"","
"0","  year = acs_year,"
"0","  variables = acs_vars,"
"0","  survey = ""acs5"","
"0","  output = ""wide"","
"0","  geometry = TRUE"
"0",")"
"0",""
"0","# Keep tracts intersecting Chicago boundary; compute metrics"
"0","tracts_chi <- tracts_all %>%"
"0","  st_transform(st_crs(chicagoBoundary)) %>%"
"0","  st_filter(chicagoBoundary, .predicate = st_intersects) %>%"
"0","  dplyr::mutate("
"0","    # Age totals"
"0","    pop45_64 = (m45_49E + m50_54E + m55_59E + m60_61E + m62_64E +"
"0","                f45_49E + f50_54E + f55_59E + f60_61E + f62_64E),"
"0","    pop65p   = (m65_66E + m67_69E + m70_74E + m75_79E + m80_84E + m85pE +"
"0","                f65_66E + f67_69E + f70_74E + f75_79E + f80_84E + f85pE),"
"0",""
"0","    # Percentages"
"0","    pct_white   = 100 * whiteE / pmax(tot_popE, 1),"
"0","    pct_black   = 100 * blackE / pmax(tot_popE, 1),"
"0","    pct_hisp    = 100 * hispE  / pmax(tot_popE, 1),"
"0","    pct_poverty = 100 * pov_numE / pmax(pov_totE, 1),"
"0","    pct_renter  = 100 * rentersE / pmax(occ_totE, 1),"
"0","    pct_vacant  = 100 * vac_cntE / pmax(vac_totE, 1),"
"0","    pct_45_64   = 100 * pop45_64 / pmax(tot_popE, 1),"
"0","    pct_65_plus = 100 * pop65p   / pmax(tot_popE, 1),"
"0",""
"0","    med_income  = med_incE"
"0","  ) %>%"
"0","  dplyr::select(GEOID, pct_white, pct_black, pct_hisp,"
"0","                pct_poverty, pct_renter, pct_vacant,"
"0","                med_income, pct_45_64, pct_65_plus)"
"0",""
"0","# Join tract attributes to fishnet (centroid/any-intersection)"
"0","fishnet <- fishnet %>%"
"0","  st_join(tracts_chi, join = st_intersects, left = TRUE)"
"0",""
"0","# (optional) peek"
"0","knitr::kable("
"0","  fishnet %>%"
"0","    sf::st_drop_geometry() %>%"
"0","    dplyr::select("
"0","      abandoned_houses, pct_black, pct_hisp, pct_white,"
"0","      pct_poverty, pct_renter, pct_vacant, med_income,"
"0","      pct_45_64, pct_65_plus"
"0","    ) %>%"
"0","    dplyr::slice(1:6),"
"0","  caption = ""Sample of ACS features joined to fishnet"","
"0","  booktabs = TRUE"
"0",") %>%"
"0","  kableExtra::kable_styling(full_width = FALSE,"
"0","                            bootstrap_options = c(""condensed"",""striped""))"
