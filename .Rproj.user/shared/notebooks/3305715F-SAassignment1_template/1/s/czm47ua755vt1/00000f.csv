"0","# Calculate MOE percentages for white, Black, and Hispanic variables"
"0","# Hint: use the same formula as before (margin/estimate * 100)"
"0",""
"0","# Create a flag for tracts with high MOE on any demographic variable"
"0","# Use logical operators (| for OR) in an ifelse() statement"
"0",""
"0","county_codes_state <- unique(stringr::str_sub(county$GEOID, 3, 5))"
"0",""
"0","race_vars <- c("
"0","  total    = ""B03002_001"","
"0","  white    = ""B03002_003"","
"0","  black    = ""B03002_004"","
"0","  hispanic = ""B03002_012"""
"0",")"
"0",""
"0","tract_state_raw <- get_acs("
"0","  geography = ""tract"","
"0","  state     = my_state,"
"0","  county    = county_codes_state,  # all counties in the state"
"0","  survey    = ""acs5"","
"0","  year      = 2022,"
"0","  variables = race_vars,"
"0","  output    = ""wide"""
"0",")"
"0",""
"0","tract_state_percent <- tract_state_raw %>%"
"0","  mutate("
"0","    county_code  = substr(GEOID, 3, 5),"
"0","    pct_white    = 100 * (whiteE    / totalE),"
"0","    pct_black    = 100 * (blackE    / totalE),"
"0","    pct_hispanic = 100 * (hispanicE / totalE),"
"0","    tract_label  = stringr::str_remove(NAME, paste0("", "", my_state)),"
"0","    tract_label  = stringr::str_remove(tract_label, "", United States$"")"
"0","  ) %>%"
"0","  left_join("
"0","    county %>%"
"0","      transmute("
"0","        county_code = substr(GEOID, 3, 5),"
"0","        county_name"
"0","      ),"
"0","    by = ""county_code"""
"0","  )"
"0",""
"0","tract_quality <- tract_state_percent %>%"
"0","  mutate("
"0","    moe_total_pct    = 100 * (totalM    / totalE),"
"0","    moe_white_pct    = 100 * (whiteM    / whiteE),"
"0","    moe_black_pct    = 100 * (blackM    / blackE),"
"0","    moe_hispanic_pct = 100 * (hispanicM / hispanicE),"
"0","    high_moe_flag = (moe_white_pct > 15) | (moe_black_pct > 15) | (moe_hispanic_pct > 15)"
"0","  )"
"0",""
"0","tract_quality_summary <- tract_quality %>%"
"0","  summarise("
"0","    tracts_total     = n(),"
"0","    tracts_high_moe  = sum(high_moe_flag, na.rm = TRUE),"
"0","    percent_high_moe = round(100 * tracts_high_moe / tracts_total, 1)"
"0","  )"
"0",""
"0","kable("
"0","  tract_quality_summary,"
"0","  caption   = ""Tract-Level High-MOE Summary (>15% on any demographic variable) â€” Statewide"","
"0","  col.names = c(""Total Tracts"", ""High-MOE Tracts"", ""Percent High-MOE (%)""),"
"0","  align     = ""c"""
"0",")"
