"0","#| label: Tract-Level Vulnerability Map"
"0","#| message: false"
"0","#| warning: false"
"0",""
"0","# 1) Prepare tract status for mapping"
"0","tracts_for_map <- PA_tracts %>%"
"0","  sf::st_transform(3365) %>%"
"0","  dplyr::mutate("
"0","    tract_status = dplyr::case_when("
"0","      underserved ~ ""Underserved vulnerable"","
"0","      vulnerable  ~ ""Vulnerable (≤ 15 mi)"","
"0","      TRUE        ~ ""Other tracts"""
"0","    ),"
"0","    tract_status = factor("
"0","      tract_status,"
"0","      levels = c(""Underserved vulnerable"", ""Vulnerable (≤ 15 mi)"", ""Other tracts"")"
"0","    )"
"0","  )"
"0",""
"0","# 2) Plot with hospitals symbol integrated into legend"
"0","ggplot() +"
"0","  # Background tracts"
"0","  geom_sf("
"0","    data  = dplyr::filter(tracts_for_map, tract_status == ""Other tracts""),"
"0","    fill  = ""#F2F2F2"", color = NA"
"0","  ) +"
"0","  # Vulnerable but near hospitals"
"0","  geom_sf("
"0","    data  = dplyr::filter(tracts_for_map, tract_status == ""Vulnerable (≤ 15 mi)""),"
"0","    aes(fill = tract_status),"
"0","    color = NA,"
"0","    alpha = 0.9"
"0","  ) +"
"0","  # Underserved vulnerable"
"0","  geom_sf("
"0","    data  = dplyr::filter(tracts_for_map, tract_status == ""Underserved vulnerable""),"
"0","    aes(fill = tract_status),"
"0","    color = NA"
"0","  ) +"
"0","  # County outlines"
"0","  geom_sf("
"0","    data  = pa_proj,"
"0","    fill  = NA, color = ""white"", linewidth = 0.4"
"0","  ) +"
"0","  # Hospital locations (added to legend)"
"0","  geom_sf("
"0","    data = hospitals_proj,"
"0","    aes(shape = ""Hospitals""),  # <—— This makes a new legend key for hospitals"
"0","    color = ""black"","
"0","    size  = 1.1,"
"0","    alpha = 0.8,"
"0","    inherit.aes = FALSE"
"0","  ) +"
"0","  # Manual fill colors"
"0","  scale_fill_manual("
"0","    name   = NULL,"
"0","    values = c("
"0","      ""Underserved vulnerable"" = ""#C0392B"","
"0","      ""Vulnerable (≤ 15 mi)""   = ""#7F8C8D"""
"0","    ),"
"0","    breaks = c(""Underserved vulnerable"", ""Vulnerable (≤ 15 mi)""),"
"0","    drop   = FALSE"
"0","  ) +"
"0","  # Add legend symbol for hospitals"
"0","  scale_shape_manual("
"0","    name   = NULL,"
"0","    values = c(""Hospitals"" = 16)  # solid circle"
"0","  ) +"
"0","  guides("
"0","    fill  = guide_legend(order = 1, override.aes = list(alpha = 1)),"
"0","    shape = guide_legend(order = 2, override.aes = list(size = 3, color = ""black""))"
"0","  ) +"
"0","  labs("
"0","    title    = ""Underserved Vulnerable Census Tracts in Pennsylvania"","
"0","    subtitle = ""Tracts with low income & high elderly share located >15 miles from the nearest hospital"","
"0","    caption  = ""Sources: ACS 2018–2022 (tidycensus); Course hospitals & PA counties. Projection: EPSG:3365"""
"0","  ) +"
"0","  coord_sf(datum = NA) +"
"0","  theme_void() +"
"0","  theme("
"0","    legend.position = ""right"","
"0","    legend.title    = element_blank(),"
"0","    legend.text     = element_text(size = 10),"
"0","    plot.title      = element_text(face = ""bold"", size = 14),"
"0","    plot.subtitle   = element_text(size = 11),"
"0","    plot.caption    = element_text(size = 9)"
"0","  )"
