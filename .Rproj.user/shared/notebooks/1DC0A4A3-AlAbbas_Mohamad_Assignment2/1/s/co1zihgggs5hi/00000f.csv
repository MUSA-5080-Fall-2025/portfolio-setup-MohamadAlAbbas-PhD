"0","#| label: Hospital Distance Matrix"
"0","#| message: false"
"0","#| warning: false"
"0","#| results: ""hide"" #Remove this to see results of Kable"
"0",""
"0",""
"0","# Distances are only meaningful in a projected CRS (not WGS84 lon/lat)."
"0","# Using a feet-based CRS lets st_distance() return feet directly."
"0","# We use the NAD83, 3365 projection designed for Pennsylvania South (ftUS)"
"0","# as the state plane, 3365 is the ideal projection for distance calculations"
"0","pa_proj <- st_transform(pa_counties, 3365)"
"0","hospitals_proj <- st_transform(hospitals, 3365)"
"0","tracts_proj <- st_transform(PA_tracts, 3365)"
"0",""
"0","# Compute polygon centroids AFTER projection. (Safer than doing so in lon/lat.)"
"0","# If you need guaranteed interior points for odd-shaped tracts, consider st_point_on_surface()."
"0","tract_centroids <- tracts_proj %>%"
"0","  st_centroid()"
"0",""
"0","# st_distance() returns an N_tracts x N_hospitals matrix with linear units of the CRS (here: feet)."
"0","dist_matrix <- st_distance(tract_centroids, hospitals_proj)"
"0",""
"0","# Take the minimum across each row (each tract) â†’ nearest hospital distance (feet)."
"0","tract_centroids$nearest_hosp_ft <- apply(dist_matrix, 1, min)"
"0",""
"0","# Also compute miles for easier interpretation."
"0","tract_centroids <- tract_centroids %>%"
"0","  mutate(nearest_hosp_miles = nearest_hosp_ft / 5280)"
"0",""
"0","PA_tracts <- tracts_proj %>%"
"0","  left_join("
"0","    tract_centroids %>%"
"0","      st_drop_geometry() %>%"
"0","      select(GEOID, nearest_hosp_miles),"
"0","    by = ""GEOID"""
"0","  )"
"0",""
"0","# Average distance to nearest hospital (miles)"
"0","# Maximum distance (miles)"
"0","# Count of tracts farther than 15 miles"
"0",""
"0","vuln_summary <- PA_tracts %>%"
"0","  st_drop_geometry() %>%"
"0","  filter(vulnerable == TRUE) %>%"
"0","  summarize("
"0","    avg_distance_miles = mean(nearest_hosp_miles, na.rm = TRUE),"
"0","    max_distance_miles = max(nearest_hosp_miles, na.rm = TRUE),"
"0","    tracts_over_15mi = sum(nearest_hosp_miles > 15, na.rm = TRUE)"
"0","  )"
"0",""
"0","knitr::kable(vuln_summary, caption = ""Distance to Nearest Hospital (Vulnerable Tracts)"")"
