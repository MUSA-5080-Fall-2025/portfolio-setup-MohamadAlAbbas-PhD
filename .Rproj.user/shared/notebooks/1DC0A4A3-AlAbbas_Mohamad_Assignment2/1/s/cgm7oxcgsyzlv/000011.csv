"0","#| label: Vulnerability Calculations"
"0","#| message: false"
"0","#| warning: false"
"0","#| results: ""hide"" #Remove this to see results of Kable"
"0",""
"0","# The variable `share65` represents the proportion of the total population"
"0","# aged 65 and older. This will be used to identify tracts with a high"
"0","# concentration of elderly residents."
"0",""
"0","PA_tracts <- PA_tracts %>%"
"0","  mutate("
"0","    share65 = pop65plus / total_popE"
"0","  )"
"0",""
"0",""
"0","# Low income: bottom quartile (≤ 25th percentile) of median household income"
"0","# High elderly: top quartile (≥ 75th percentile) of the 65+ share"
"0",""
"0","Inc_threshold <- quantile(PA_tracts$medhhincE, probs = 0.25, na.rm = TRUE)"
"0","age_threshold <- quantile(PA_tracts$share65, probs = 0.75, na.rm = TRUE)"
"0",""
"0",""
"0","# A tract is classified as “vulnerable” if BOTH conditions are met:"
"0","# (1) Median household income is below or equal to the 25th percentile, AND"
"0","# (2) Elderly share is above or equal to the 75th percentile."
"0",""
"0","PA_tracts <- PA_tracts %>%"
"0","  mutate("
"0","    low_income = medhhincE <= Inc_threshold,  # Low-income indicator"
"0","    older_pop  = share65 >= age_threshold,    # High-elderly indicator"
"0","    vulnerable = low_income & older_pop       # Combined vulnerability flag"
"0","  )"
"0",""
"0",""
"0","# `n_vuln`: total number of tracts meeting both criteria"
"0","# `pct_vuln`: percentage of all tracts that are vulnerable"
"0",""
"0","n_vuln <- sum(PA_tracts$vulnerable, na.rm = TRUE)"
"0","pct_vuln <- n_vuln / nrow(PA_tracts)"
"0",""
"0",""
"0","# The table reports the income and elderly thresholds used, the number of"
"0","# vulnerable tracts, and their share of all tracts. `scales::dollar()` and"
"0","# `scales::percent()` are used to format the values for readability."
"0",""
"0","knitr::kable("
"0","  tibble::tibble("
"0","    `Income threshold (25th percentile)`        = scales::dollar(as.numeric(Inc_threshold)),"
"0","    `Elderly share threshold (75th percentile)` = scales::percent(as.numeric(age_threshold), accuracy = 0.1),"
"0","    `# Vulnerable tracts`                        = n_vuln,"
"0","    `% of all tracts that are vulnerable`       = scales::percent(pct_vuln, accuracy = 0.1)"
"0","  ),"
"0","  caption = ""Vulnerability thresholds and counts (low income + high elderly share)"""
"0",")"
